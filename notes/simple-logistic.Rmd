# APCs in a simple logistic regression example

```{r message=FALSE, echo=FALSE}
library(knitr)
knitr::opts_chunk$set(tidy = FALSE, message=FALSE, warning=FALSE, fig.align='center')
```

```{r echo=TRUE}
library(predcomps)
library(ggplot2)
```

## Input Generation

```


## Outcome Generation

```{r}
N <- 200
logit <- function(x) 1/(1+exp(-x))
outcomeGenerationFunction <- function(df) {
  with(df, logit(v1 + v2*2))
  }
```

## Computing and Plotting the APC

```{r ApcPlotsTwoWays}

GetApcDF(outcomeGenerationFunction, data.frame(v1=rnorm(N)*.1, v2=rnorm(N)*.1), c("v1","v2"))

GetApcDF(outcomeGenerationFunction, data.frame(v1=rnorm(N), v2=rnorm(N)), c("v1","v2"))

GetApcDF(outcomeGenerationFunction, data.frame(v1=rnorm(N)*10, v2=rnorm(N)*10), c("v1","v2"))

GetApcDF(outcomeGenerationFunction, data.frame(v1=rnorm(N)*100, v2=rnorm(N)*100), c("v1","v2"))


set.seed(889)
(GetApcDF(outcomeGenerationFunction, data.frame(v1=rnorm(N)*1000, v2=rnorm(N)*1000), c("v1","v2"), 
          mahalanobisConstantTerm = .1))

# something is wrong. shouldn't these APCs become similar for v1 and v2 as the 
# no b/c the one with the larger effect can better overcome, more likely to cause a 1/-1 flip


N=500
v1 <- rnorm(N)*3
v2 <- rnorm(N) * (abs(v1) > 2)
v3 <- rnorm(N) * (abs(v1) < .5)

df <- data.frame(v1,v2,v3)
df$y <- rbinom(n=nrow(df), size=1, prob=with(df, logit(v1+v2+v3)))

fittedLogit <- glm(y ~ v1 + v2 + v3, data = df, family = "binomial")

GetApcDF(function(df) with(df, logit(v1+v2+v3)), 
         data.frame(v1, v2, v3), 
         c("v1","v2","v3"))

GetApcDF(fittedLogit, 
         data.frame(v1, v2, v3), 
         c("v1","v2","v3"))



GetApcDF


apcDf
PlotApcDF(apcDf)
PlotApcDF2(apcDf)

## plot the curves

```
