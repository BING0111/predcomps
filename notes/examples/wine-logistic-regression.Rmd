```{r echo=FALSE, results='hide', message=FALSE}
library(predcomps)
library(ggplot2)
library(boot)
```


## A Logistic Regression with Related Inputs

I will set up a simulated data set that we use for modeling the probability a candidate wins an election, given how much time they spend campaigning and how much money is spend on their campaign. The data will be entirely simulated. I'll set up and compare a few variations in which the relationship between time and money vary. The coefficients of the logistic regression determining the relationship between the inputs and the probability of election success will not vary.

### Variation 1

In the first variation, time and money are independent:

```{r}
priceCoefficient <- -.12
qualityCoefficient <- .1
noiseSD <- 5

nWines=50000  # we'll use a sample of 10k wines
price <- sample(20:120, nWines, replace=TRUE)
quality <- price * .4 + 22 + rnorm(nWines, sd=noiseSD)
purchaseProbability = inv.logit( priceCoefficient*(price - 70) + qualityCoefficient*(quality - 50)  )

df1 <- data.frame(Quality = quality, 
                 Price = price, 
                 PurchaseProbability = purchaseProbability, 
                 Purchased = rbinom(n = length(purchaseProbability), size=1, prob=purchaseProbability))


```

Here is the (admittedly unrealistic) relationship between price and quality:

```{r}
df1Sample <- df1[sample.int(nWines, size=1000), ]
qplot(Price, Quality, alpha=I(.5), data = df1Sample) + 
  expand_limits(y=c(0,100))
```

When I fit a logistic regression, the coefficients are what we'd expect (since we set them up):

 
```{r}
logitFit1 <- glm(Purchased ~ Price + Quality, data = df1, family = "binomial")
logitFit1

```

This plot shows the relationship between quality and predicted pir
  
```{r}

ggplot(subset(df1, Price %in% seq(20, 120, by=10))) + 
  geom_point(aes(x = Quality, y = PurchaseProbability, color = factor(Price)),
             size = 3, alpha = .1)



df$y <- rbinom(n=nrow(df), size=1, prob=with(df, inv.logit(v1+v2+v3)))

fittedLogit <- glm(y ~ v1 + v2 + v3, data = df, family = "binomial")

apcDF <- GetPredCompsDF(function(df) with(df, inv.logit(v1+v2+v3)), df, c("v1","v2","v3"))

PlotPredCompsDF(apcDF)
PlotPredCompsDF(apcDF, variant="Apc")


GetPredCompsDF(fittedLogit, 
               data.frame(v1, v2, v3), 
               c("v1","v2","v3"))



GetPredCompsDF

```

