---
layout: page
---

<h1>A new way to visualize models</h1>

<pre><code class="r">diamonds &lt;- transform(diamonds, clarity = 
                        factor(clarity, levels =c(&quot;SI1&quot;, &quot;SI2&quot;, &quot;VS1&quot;, &quot;VS2&quot;, &quot;VVS1&quot;, &quot;VVS2&quot;, &quot;IF&quot;)))

diamonds2 &lt;- transform(diamonds,
                       clarity = as.integer(clarity),
                       cut = as.integer(cut),
                       color = as.integer(color))

diamonds3 &lt;- subset(diamonds2, !is.na(clarity))

rf &lt;- randomForest(price ~ carat + cut + color + clarity, data=diamonds3, ntree=20)
diamondsSmall &lt;- diamonds3[sample.int(nrow(diamonds3), size=500), ]

apcDf &lt;- GetPredCompsDF(function(df) predict(rf, df), diamondsSmall, inputVars=row.names(rf$importance))
</code></pre>

<pre><code>## Working on: carat 
## Working on: cut 
## Working on: color 
## Working on: clarity
</code></pre>

<pre><code class="r">PlotPredCompsDF(apcDf)
</code></pre>

<pre><code>## Error: could not find function &quot;melt&quot;
</code></pre>

<pre><code class="r">PlotPredCompsDF(apcDf, variant=&quot;Apc&quot;)
</code></pre>

<pre><code>## Error: could not find function &quot;melt&quot;
</code></pre>

<pre><code class="r">

pairs &lt;- GetPairs(diamondsSmall, &quot;carat&quot;, c(&quot;cut&quot;, &quot;color&quot;, &quot;clarity&quot;), 
                  removeDiagonal=FALSE,
                  mahalanobisConstantTerm=.1)
</code></pre>

<pre><code>## Error: unused argument (removeDiagonal = FALSE)
</code></pre>

<pre><code class="r">
u &lt;- &quot;carat&quot;
pairsSampled &lt;- ddply(pairs, 
                      &quot;OriginalRowNumber&quot;, function(df) {
                        df[sample.int(nrow(df), size=5, prob=df$Weight), ]
                        })
</code></pre>

<pre><code>## Error: missing value where TRUE/FALSE needed
</code></pre>

<pre><code class="r">
originalRowNumbersToUse &lt;- sample(unique(pairsSampled$OriginalRowNumber), size=10)
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled$carat &lt;- pairsSampled$carat.B
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled$Prediction &lt;- predict(rf, pairsSampled)
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
ggplot(subset(pairsSampled, OriginalRowNumber %in% originalRowNumbersToUse),
       aes(x=carat, y=Prediction, color=factor(OriginalRowNumber, levels=sample(originalRowNumbersToUse)))) +
  geom_point() +
  geom_line(size=.2) 
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
last_plot() + scale_x_continuous(limits=c(0,1)) + scale_y_continuous(limits=c(0,5000))
</code></pre>

<pre><code>## Error: non-numeric argument to binary operator
</code></pre>

<pre><code class="r">


u &lt;- &quot;clarity&quot;
v &lt;- c(&quot;carat&quot;, &quot;cut&quot;, &quot;color&quot;)
pairs &lt;- GetPairs(diamondsSmall, u, v, 
                  removeDiagonal=FALSE,
                  mahalanobisConstantTerm=.1)
</code></pre>

<pre><code>## Error: unused argument (removeDiagonal = FALSE)
</code></pre>

<pre><code class="r">
pairsSampled &lt;- ddply(pairs, 
                      &quot;OriginalRowNumber&quot;, function(df) {
                        df[sample.int(nrow(df), size=5, prob=df$Weight), ]
                        })
</code></pre>

<pre><code>## Error: missing value where TRUE/FALSE needed
</code></pre>

<pre><code class="r">
originalRowNumbersToUse &lt;- sample(unique(pairsSampled$OriginalRowNumber), size=10)
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled[[u]] &lt;- pairsSampled[[paste0(u,&quot;.B&quot;)]]
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled$Prediction &lt;- predict(rf, pairsSampled)
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled$OriginalRowNumberFactor &lt;- factor(pairsSampled$OriginalRowNumber, levels=sample(originalRowNumbersToUse))
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">ggplot(subset(pairsSampled, OriginalRowNumber %in% originalRowNumbersToUse),
       aes_string(x=u, y=&quot;Prediction&quot;, color=&quot;OriginalRowNumberFactor&quot;)) +
  geom_point() +
  geom_line(size=.2) 
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">


u &lt;- &quot;color&quot;
v &lt;- c(&quot;cut&quot;, &quot;clarity&quot;, &quot;carat&quot;)
pairs &lt;- GetPairs(diamondsSmall, u, v, 
                  removeDiagonal=FALSE,
                  mahalanobisConstantTerm=.1)
</code></pre>

<pre><code>## Error: unused argument (removeDiagonal = FALSE)
</code></pre>

<pre><code class="r">
pairsSampled &lt;- ddply(pairs, 
                      &quot;OriginalRowNumber&quot;, function(df) {
                        df[sample.int(nrow(df), size=5, prob=df$Weight), ]
                        })
</code></pre>

<pre><code>## Error: missing value where TRUE/FALSE needed
</code></pre>

<pre><code class="r">
originalRowNumbersToUse &lt;- sample(unique(pairsSampled$OriginalRowNumber), size=10)
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled[[u]] &lt;- pairsSampled[[paste0(u,&quot;.B&quot;)]]
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled$Prediction &lt;- predict(rf, pairsSampled)
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
pairsSampled$OriginalRowNumberFactor &lt;- factor(pairsSampled$OriginalRowNumber, levels=sample(originalRowNumbersToUse))
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">ggplot(subset(pairsSampled, OriginalRowNumber %in% originalRowNumbersToUse),
       aes_string(x=u, y=&quot;Prediction&quot;, color=&quot;OriginalRowNumberFactor&quot;)) +
  geom_point() +
  geom_line(size=.2) 
</code></pre>

<pre><code>## Error: object &#39;pairsSampled&#39; not found
</code></pre>

<pre><code class="r">
</code></pre>

